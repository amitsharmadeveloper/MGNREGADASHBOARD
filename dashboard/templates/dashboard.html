{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ district_name }} - MGNREGA Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
   <header class="navbar">
    <div class="logo">
        <img src="{% static 'images/logo.jpg' %}" alt="MGNREGA Logo">
    </div>

    <!-- Hamburger Icon (Visible only on Mobile) -->
    <div class="hamburger" onclick="toggleMenu()">
        &#9776;
    </div>

    <nav id="menu">
        <a href="{% url 'home' %}">Home</a>
    </nav>
</header>

<script>
    function toggleMenu() {
        const menu = document.getElementById("menu");
        menu.classList.toggle("active");
    }
</script>


    <header class="display"> 
        <h1>MGNREGA District Performance</h1>
        <p><strong>{{ district_name }}</strong> | Financial Year: {{ year }}</p>
        {% if month %}
            <p>Month: <strong>{{ month }}</strong></p>
        {% endif %}
    </header>

    {% if error %}
        <div class="error">{{ error }}</div>
    {% else %}

        <!--Summary Cards-->
<section class="summary-section">
    <div class="summary-card">
        <h3>Approved Labour Budget</h3>
        <p>₹ {{ total_budget|floatformat:0 }}</p>
        <small class="explain">Money given to district for worker wages</small>
    </div>

    <div class="summary-card">
        <h3>Average Wage Rate</h3>
        <p>₹ {{ avg_wage }}</p>
        <small class="explain">How much a worker earns per day</small>
    </div>

    <div class="summary-card">
        <h3>Avg. Days of Employment</h3>
        <p>{{ avg_employment_days }}</p>
        <small class="explain">Average days people got work this year</small>
    </div>

    <div class="summary-card">
        <h3>Total Records</h3>
        <p>{{ total_records }}</p>
        <small class="explain">Total number of data months available</small>
    </div>
</section>

<!--Charts Section-->
<section class="chart-section">
    <div class="chart-card">
        <h2>Average Wage Rate Trend</h2>
        <small class="chart-explain">Shows how wages changed every month</small>
        <canvas id="wageChart"></canvas>
    </div>

    <div class="chart-card">
        <h2>Average Days of Employment Trend</h2>
        <small class="chart-explain">Shows how many days work was given each month</small>
        <canvas id="employmentChart"></canvas>
    </div>
</section>


        <!--Data Table-->
        <section class="table-section">
            <h2> Detailed District Data </h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            {% for key, value in records.0.items %}
                                <th>{{ key|capfirst }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in records %}
                            <tr>
                                {% for key, value in record.items %}
                                    <td>{{ value }}</td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!--Chart Scripts-->
        <script>
            const months = {{ months|safe }};
            const wageTrend = {{ wage_trend|safe }};
            const employmentTrend = {{ employment_trend|safe }};

            // Wage Trend Chart
            new Chart(document.getElementById('wageChart'), {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Average Wage (₹)',
                        data: wageTrend,
                        borderColor: '#ff0000',
                        backgroundColor: 'rgba(255, 0, 0, 0.2)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointBackgroundColor: '#ff4444'
                    }]
                },
                options: {
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        x: { ticks: { color: '#fff' } },
                        y: { ticks: { color: '#fff' } }
                    }
                }
            });

            // Employment Trend Chart
            new Chart(document.getElementById('employmentChart'), {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Avg Employment Days',
                        data: employmentTrend,
                        backgroundColor: 'rgba(255, 0, 0, 0.8)',
                        borderColor: '#ff0000',
                        borderWidth: 1
                    }]
                },
                options: {
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        x: { ticks: { color: '#fff' } },
                        y: { ticks: { color: '#fff' } }
                    }
                }
            });
        </script>

    {% endif %}
</body>
</html>
